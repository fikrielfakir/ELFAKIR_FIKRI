// Translation data
const translations = {
    en: {
        "hero.name": "Fikri El Fakir",
        "hero.title": "Full-Stack Web Developer",
        "hero.location": "Al Hoceima, Morocco",
        "hero.description": "Passionate and results-driven Full-Stack Web Developer with extensive experience in developing high-quality, scalable applications. Specializing in React, Node.js, and modern web technologies to drive digital transformation.",
        "hero.getInTouch": "Get In Touch",
        "hero.viewGithub": "View GitHub",
        "hero.linkedin": "LinkedIn",
        "experience.title": "Professional Experience",
        "experience.subtitle": "Building innovative solutions and driving digital transformation across diverse industries",
        "projects.title": "Featured Projects",
        "projects.subtitle": "Showcasing innovative web solutions that solve real-world problems",
        "projects.viewProject": "View Project",
        "projects.source": "Source",
        "skills.title": "Skills & Expertise",
        "skills.subtitle": "Comprehensive technical skills across the full development stack",
        "education.title": "Education & Certifications",
        "education.subtitle": "Academic foundation and continuous learning in technology",
        "contact.title": "Get In Touch",
        "contact.subtitle": "Let's collaborate on your next project or discuss exciting opportunities",
        "contact.information": "Contact Information",
        "contact.connectWithMe": "Connect with me",
        "contact.workTogether": "Let's Work Together",
        "contact.workDescription": "I'm always excited to work on innovative projects and collaborate with talented individuals. Whether you have a project in mind, need technical consultation, or just want to connect, I'd love to hear from you.",
        "contact.canHelpWith": "What I can help with:",
        "contact.sendEmail": "Send me an Email",
        "contact.interests": "Beyond Code - Interests & Hobbies",
        "contact.footer": "Built with ❤️ using React & TypeScript"
    },
    fr: {
        "hero.name": "Fikri El Fakir",
        "hero.title": "Développeur Web Full-Stack",
        "hero.location": "Al Hoceima, Maroc",
        "hero.description": "Développeur Web Full-Stack passionné et axé sur les résultats avec une vaste expérience dans le développement d'applications évolutives et de haute qualité. Spécialisé dans React, Node.js et les technologies web modernes pour conduire la transformation numérique.",
        "hero.getInTouch": "Prenez Contact",
        "hero.viewGithub": "Voir GitHub",
        "hero.linkedin": "LinkedIn",
        "experience.title": "Expérience Professionnelle",
        "experience.subtitle": "Créer des solutions innovantes et conduire la transformation numérique dans divers domaines",
        "projects.title": "Projets en Vedette",
        "projects.subtitle": "Présentation de solutions web innovantes qui résolvent des problèmes du monde réel",
        "projects.viewProject": "Voir le Projet",
        "projects.source": "Source",
        "skills.title": "Compétences et Expertise",
        "skills.subtitle": "Compétences techniques complètes dans toute la pile de développement",
        "education.title": "Formation et Certifications",
        "education.subtitle": "Base académique et apprentissage continu en technologie",
        "contact.title": "Prenez Contact",
        "contact.subtitle": "Collaborons sur votre prochain projet ou discutons d'opportunités passionnantes",
        "contact.information": "Informations de Contact",
        "contact.connectWithMe": "Connectez-vous avec moi",
        "contact.workTogether": "Travaillons Ensemble",
        "contact.workDescription": "Je suis toujours ravi de travailler sur des projets innovants et de collaborer avec des personnes talentueuses. Que vous ayez un projet en tête, que vous ayez besoin de conseils techniques ou que vous souhaitiez simplement vous connecter, j'aimerais avoir de vos nouvelles.",
        "contact.canHelpWith": "Ce avec quoi je peux aider:",
        "contact.sendEmail": "Envoyez-moi un Email",
        "contact.interests": "Au-delà du Code - Intérêts et Loisirs",
        "contact.footer": "Construit avec ❤️ en utilisant React & TypeScript"
    },
    es: {
        "hero.name": "Fikri El Fakir",
        "hero.title": "Desarrollador Web Full-Stack",
        "hero.location": "Al Hoceima, Marruecos",
        "hero.description": "Desarrollador Web Full-Stack apasionado y orientado a resultados con amplia experiencia en el desarrollo de aplicaciones escalables y de alta calidad. Especializado en React, Node.js y tecnologías web modernas para impulsar la transformación digital.",
        "hero.getInTouch": "Ponte en Contacto",
        "hero.viewGithub": "Ver GitHub",
        "hero.linkedin": "LinkedIn",
        "experience.title": "Experiencia Profesional",
        "experience.subtitle": "Construyendo soluciones innovadoras e impulsando la transformación digital en diversas industrias",
        "projects.title": "Proyectos Destacados",
        "projects.subtitle": "Mostrando soluciones web innovadoras que resuelven problemas del mundo real",
        "projects.viewProject": "Ver Proyecto",
        "projects.source": "Fuente",
        "skills.title": "Habilidades y Experiencia",
        "skills.subtitle": "Habilidades técnicas integrales en toda la pila de desarrollo",
        "education.title": "Educación y Certificaciones",
        "education.subtitle": "Base académica y aprendizaje continuo en tecnología",
        "contact.title": "Ponte en Contacto",
        "contact.subtitle": "Colaboremos en tu próximo proyecto o discutamos oportunidades emocionantes",
        "contact.information": "Información de Contacto",
        "contact.connectWithMe": "Conéctate conmigo",
        "contact.workTogether": "Trabajemos Juntos",
        "contact.workDescription": "Siempre estoy emocionado de trabajar en proyectos innovadores y colaborar con personas talentosas. Ya sea que tengas un proyecto en mente, necesites consultoría técnica o simplemente quieras conectar, me encantaría saber de ti.",
        "contact.canHelpWith": "En qué puedo ayudar:",
        "contact.sendEmail": "Envíame un Email",
        "contact.interests": "Más allá del Código - Intereses y Pasatiempos",
        "contact.footer": "Construido con ❤️ usando React y TypeScript"
    },
    de: {
        "hero.name": "Fikri El Fakir",
        "hero.title": "Full-Stack Webentwickler",
        "hero.location": "Al Hoceima, Marokko",
        "hero.description": "Leidenschaftlicher und ergebnisorientierter Full-Stack Webentwickler mit umfangreicher Erfahrung in der Entwicklung hochwertiger, skalierbarer Anwendungen. Spezialisiert auf React, Node.js und moderne Webtechnologien zur Förderung der digitalen Transformation.",
        "hero.getInTouch": "Kontakt aufnehmen",
        "hero.viewGithub": "GitHub ansehen",
        "hero.linkedin": "LinkedIn",
        "experience.title": "Berufserfahrung",
        "experience.subtitle": "Innovative Lösungen entwickeln und digitale Transformation in verschiedenen Branchen vorantreiben",
        "projects.title": "Ausgewählte Projekte",
        "projects.subtitle": "Präsentation innovativer Web-Lösungen, die reale Probleme lösen",
        "projects.viewProject": "Projekt ansehen",
        "projects.source": "Quelle",
        "skills.title": "Fähigkeiten und Expertise",
        "skills.subtitle": "Umfassende technische Fähigkeiten im gesamten Entwicklungsstack",
        "education.title": "Bildung und Zertifizierungen",
        "education.subtitle": "Akademische Grundlage und kontinuierliches Lernen in der Technologie",
        "contact.title": "Kontakt aufnehmen",
        "contact.subtitle": "Lassen Sie uns an Ihrem nächsten Projekt zusammenarbeiten oder spannende Möglichkeiten besprechen",
        "contact.information": "Kontaktinformationen",
        "contact.connectWithMe": "Verbinde dich mit mir",
        "contact.workTogether": "Lasst uns zusammenarbeiten",
        "contact.workDescription": "Ich bin immer begeistert, an innovativen Projekten zu arbeiten und mit talentierten Personen zusammenzuarbeiten. Ob Sie ein Projekt im Kopf haben, technische Beratung benötigen oder sich einfach nur vernetzen möchten, ich würde gerne von Ihnen hören.",
        "contact.canHelpWith": "Womit ich helfen kann:",
        "contact.sendEmail": "Sende mir eine E-Mail",
        "contact.interests": "Jenseits des Codes - Interessen und Hobbys",
        "contact.footer": "Erstellt mit ❤️ mit React & TypeScript"
    },
    ar: {
        "hero.name": "فكري الفقير",
        "hero.title": "مطور ويب متكامل",
        "hero.location": "الحسيمة، المغرب",
        "hero.description": "مطور ويب متكامل شغوف ومركز على النتائج مع خبرة واسعة في تطوير تطبيقات عالية الجودة وقابلة للتوسع. متخصص في React وNode.js والتقنيات الحديثة لقيادة التحول الرقمي.",
        "hero.getInTouch": "تواصل معي",
        "hero.viewGithub": "عرض GitHub",
        "hero.linkedin": "LinkedIn",
        "experience.title": "الخبرة المهنية",
        "experience.subtitle": "بناء حلول مبتكرة وقيادة التحول الرقمي في مختلف المجالات",
        "projects.title": "المشاريع المميزة",
        "projects.subtitle": "عرض حلول الويب المبتكرة التي تحل مشاكل العالم الحقيقي",
        "projects.viewProject": "عرض المشروع",
        "projects.source": "المصدر",
        "skills.title": "المهارات والخبرة",
        "skills.subtitle": "مهارات تقنية شاملة عبر مجموعة التطوير الكاملة",
        "education.title": "التعليم والشهادات",
        "education.subtitle": "الأساس الأكاديمي والتعلم المستمر في التكنولوجيا",
        "contact.title": "تواصل معي",
        "contact.subtitle": "دعونا نتعاون في مشروعك القادم أو نناقش الفرص المثيرة",
        "contact.information": "معلومات الاتصال",
        "contact.connectWithMe": "تواصل معي",
        "contact.workTogether": "دعونا نعمل معاً",
        "contact.workDescription": "أنا دائماً متحمس للعمل على مشاريع مبتكرة والتعاون مع أشخاص موهوبين. سواء كان لديك مشروع في الذهن، تحتاج استشارة تقنية، أو تريد فقط التواصل، أود أن أسمع منك.",
        "contact.canHelpWith": "ما يمكنني المساعدة به:",
        "contact.sendEmail": "أرسل لي إيميل",
        "contact.interests": "ما وراء الكود - الاهتمامات والهوايات",
        "contact.footer": "بُني بـ ❤️ باستخدام React و TypeScript"
    }
};

// Projects data
const projects = [
    {
        title: "Inventory Management System",
        description: "Modern business analytics dashboard featuring comprehensive sales tracking, user management, and real-time metrics. Built with responsive design for desktop and mobile platforms.",
        period: "2024",
        location: "Morocco",
        technologies: ["React", "TypeScript", "Chart.js", "Tailwind CSS", "REST API"],
        type: "Dashboard Application",
        image: "./assets/images/orbit-dashboard.jpg"
    },
    {
        title: "Lux-foof Website",
        description: "Vibrant e-commerce website for Fritana snack products featuring colorful design, product showcase, and mobile-responsive layout. Includes brand storytelling and interactive product displays.",
        period: "2024",
        location: "Morocco",
        technologies: ["React", "Next.js", "Tailwind CSS", "E-commerce Integration", "Mobile-First"],
        type: "E-commerce Website",
        image: "./assets/images/fritana-website.jpg"
    },
    {
        title: "Manhaj School",
        description: "Comprehensive service management platform with Arabic language support, featuring clean dashboard interface, service categories, and user-friendly navigation designed for Arabic-speaking users.",
        period: "2024",
        location: "Middle East",
        technologies: ["React", "RTL Support", "i18n", "Node.js", "Arabic UI/UX"],
        type: "Service Platform",
        image: "./assets/images/arabic-platform.jpg"
    },
    {
        title: "Mahalo Classifieds Platform",
        description: "Classifieds platform with features for smooth purchase and sale of various products. Optimized user interface for improved user experience.",
        period: "July 2019 - Jan. 2020",
        location: "Tangier",
        technologies: ["Angular", "Node.js", "MySQL", "Redis"],
        type: "Full-Stack",
        image: "./assets/images/mahalo-platform.png"
    },
    {
        title: "Tabla.ma Restaurant Reservation System",
        description: "Comprehensive restaurant table reservation platform featuring table discovery, booking management, customer satisfaction tracking, and admin dashboard. Includes both customer-facing and business management interfaces.",
        period: "July 2022 - Nov. 2022",
        location: "Casablanca",
        technologies: ["React", "Express.js", "PostgreSQL", "Payment Gateway", "Dashboard Analytics"],
        type: "Full-Stack Platform",
        image: "./assets/images/tabla-landing.png"
    },
    {
        title: "Orbit POS APP Mobile",
        description: "Comprehensive business management platform with delivery tracking, dashboard analytics, and multi-language support for enhanced user experience.",
        period: "2023",
        location: "Morocco",
        technologies: ["React", "Node.js", "PostgreSQL", "i18n"],
        type: "Business Platform",
        image: "./assets/images/orbit-pos.png"
    }
];

// Current language
let currentLanguage = 'en';

// Carousel state
let currentSlide = 0;
const totalSlides = projects.length;

// DOM Elements
let langToggle, langDropdown, currentLangSpan, prevBtn, nextBtn, carouselCounter;
let projectsContainer, carouselDots;

// Initialize the application
document.addEventListener('DOMContentLoaded', function() {
    initializeElements();
    setupEventListeners();
    renderProjects();
    updateCarouselState();
    setupIntersectionObserver();
});

function initializeElements() {
    langToggle = document.getElementById('lang-toggle');
    langDropdown = document.getElementById('lang-dropdown');
    currentLangSpan = document.getElementById('current-lang');
    prevBtn = document.getElementById('prev-btn');
    nextBtn = document.getElementById('next-btn');
    carouselCounter = document.getElementById('carousel-counter');
    projectsContainer = document.getElementById('projects-container');
    carouselDots = document.getElementById('carousel-dots');
}

function setupEventListeners() {
    // Language selector
    if (langToggle) {
        langToggle.addEventListener('click', toggleLanguageDropdown);
    }

    // Language dropdown buttons
    const langButtons = document.querySelectorAll('[data-lang]');
    langButtons.forEach(button => {
        button.addEventListener('click', function() {
            changeLanguage(this.dataset.lang);
        });
    });

    // Carousel controls
    if (prevBtn) {
        prevBtn.addEventListener('click', prevSlide);
    }
    if (nextBtn) {
        nextBtn.addEventListener('click', nextSlide);
    }

    // Close language dropdown when clicking outside
    document.addEventListener('click', function(e) {
        if (langDropdown && !langToggle.contains(e.target) && !langDropdown.contains(e.target)) {
            langDropdown.classList.add('hidden');
        }
    });

    // Keyboard navigation
    document.addEventListener('keydown', function(e) {
        if (e.key === 'ArrowLeft') {
            prevSlide();
        } else if (e.key === 'ArrowRight') {
            nextSlide();
        }
    });

    // Touch support for carousel
    let touchStartX = 0;
    let touchEndX = 0;

    if (projectsContainer) {
        projectsContainer.addEventListener('touchstart', function(e) {
            touchStartX = e.changedTouches[0].screenX;
        });

        projectsContainer.addEventListener('touchend', function(e) {
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
        });
    }

    function handleSwipe() {
        const swipeThreshold = 50;
        const diff = touchStartX - touchEndX;
        
        if (Math.abs(diff) > swipeThreshold) {
            if (diff > 0) {
                nextSlide();
            } else {
                prevSlide();
            }
        }
    }
}

function toggleLanguageDropdown() {
    if (langDropdown) {
        langDropdown.classList.toggle('hidden');
    }
}

function changeLanguage(lang) {
    if (translations[lang]) {
        currentLanguage = lang;
        updateTranslations();
        updateLanguageDisplay();
        langDropdown.classList.add('hidden');
        
        // Store language preference
        localStorage.setItem('preferredLanguage', lang);
    }
}

function updateTranslations() {
    const elements = document.querySelectorAll('[data-i18n]');
    elements.forEach(element => {
        const key = element.dataset.i18n;
        if (translations[currentLanguage] && translations[currentLanguage][key]) {
            element.textContent = translations[currentLanguage][key];
        }
    });
}

function updateLanguageDisplay() {
    const languageNames = {
        en: 'English',
        fr: 'Français',
        es: 'Español',
        de: 'Deutsch',
        ar: 'العربية'
    };
    
    if (currentLangSpan && languageNames[currentLanguage]) {
        currentLangSpan.textContent = languageNames[currentLanguage];
    }
    
    // Update document direction for RTL languages
    if (currentLanguage === 'ar') {
        document.documentElement.setAttribute('dir', 'rtl');
        document.documentElement.setAttribute('lang', 'ar');
    } else {
        document.documentElement.setAttribute('dir', 'ltr');
        document.documentElement.setAttribute('lang', currentLanguage);
    }
}

function renderProjects() {
    if (!projectsContainer) return;
    
    projectsContainer.innerHTML = '';
    
    projects.forEach((project, index) => {
        const projectElement = document.createElement('div');
        projectElement.className = 'project-slide';
        projectElement.innerHTML = `
            <div class="project-card">
                <div class="project-header">
                    <div class="project-meta">
                        <span class="project-type">${project.type}</span>
                        <span class="project-period">${project.period}</span>
                    </div>
                    <h3 class="project-title">${project.title}</h3>
                    <p class="project-location">${project.location}</p>
                </div>
                <div class="project-content">
                    ${project.image ? `
                        <div class="project-image-container">
                            <img src="${project.image}" alt="${project.title} - Project Screenshot" class="project-image" loading="lazy" />
                        </div>
                    ` : ''}
                    <p class="project-description">${project.description}</p>
                    <div class="project-tech-badges">
                        ${project.technologies.map(tech => `<span class="project-tech-badge">${tech}</span>`).join('')}
                    </div>
                </div>
            </div>
        `;
        projectsContainer.appendChild(projectElement);
    });
    
    renderCarouselDots();
}

function renderCarouselDots() {
    if (!carouselDots) return;
    
    carouselDots.innerHTML = '';
    
    projects.forEach((_, index) => {
        const dot = document.createElement('button');
        dot.className = `carousel-dot ${index === currentSlide ? 'active' : ''}`;
        dot.addEventListener('click', () => goToSlide(index));
        carouselDots.appendChild(dot);
    });
}

function updateCarouselState() {
    if (projectsContainer) {
        const slideWidth = projectsContainer.children[0]?.offsetWidth || 0;
        const transform = currentLanguage === 'ar' ? 
            `translateX(${currentSlide * slideWidth}px)` : 
            `translateX(-${currentSlide * slideWidth}px)`;
        projectsContainer.style.transform = transform;
    }
    
    if (prevBtn) {
        prevBtn.disabled = currentSlide === 0;
    }
    if (nextBtn) {
        nextBtn.disabled = currentSlide >= totalSlides - 1;
    }
    
    if (carouselCounter) {
        carouselCounter.textContent = `${currentSlide + 1} / ${totalSlides}`;
    }
    
    // Update dots
    const dots = document.querySelectorAll('.carousel-dot');
    dots.forEach((dot, index) => {
        dot.classList.toggle('active', index === currentSlide);
    });
}

function nextSlide() {
    if (currentSlide < totalSlides - 1) {
        currentSlide++;
        updateCarouselState();
    }
}

function prevSlide() {
    if (currentSlide > 0) {
        currentSlide--;
        updateCarouselState();
    }
}

function goToSlide(index) {
    if (index >= 0 && index < totalSlides) {
        currentSlide = index;
        updateCarouselState();
    }
}

function setupIntersectionObserver() {
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };
    
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('animate-fade-in');
            }
        });
    }, observerOptions);
    
    // Observe all animatable elements
    const animatableElements = document.querySelectorAll(
        '.experience-card, .skill-category, .education-card, .certification-card, .contact-card, .cta-card, .interests-card, .languages-card'
    );
    
    animatableElements.forEach(element => {
        observer.observe(element);
    });
}

// Auto-play carousel (optional)
function startAutoPlay() {
    setInterval(() => {
        if (currentSlide < totalSlides - 1) {
            nextSlide();
        } else {
            currentSlide = 0;
            updateCarouselState();
        }
    }, 5000);
}

// Load preferred language from localStorage
function loadPreferredLanguage() {
    const savedLanguage = localStorage.getItem('preferredLanguage');
    if (savedLanguage && translations[savedLanguage]) {
        changeLanguage(savedLanguage);
    }
}

// Initialize preferred language on load
document.addEventListener('DOMContentLoaded', function() {
    loadPreferredLanguage();
});

// Smooth scrolling for anchor links
function initializeSmoothScroll() {
    const links = document.querySelectorAll('a[href^="#"]');
    links.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });
}

// Initialize smooth scroll
document.addEventListener('DOMContentLoaded', initializeSmoothScroll);

// Debounce function for performance
function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

// Handle window resize
const handleResize = debounce(() => {
    updateCarouselState();
}, 250);

window.addEventListener('resize', handleResize);

// Service Worker registration (for PWA capabilities)
if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js')
            .then(registration => {
                console.log('SW registered: ', registration);
            })
            .catch(registrationError => {
                console.log('SW registration failed: ', registrationError);
            });
    });
}

// Export functions for testing (if needed)
if (typeof module !== 'undefined' && module.exports) {
    module.exports = {
        changeLanguage,
        nextSlide,
        prevSlide,
        goToSlide,
        updateCarouselState
    };
}